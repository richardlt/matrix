<link rel="import" href="../../polymer/polymer-element.html">
<script src="../node_modules/socket.io-client/dist/socket.io.slim.js"></script>

<link rel="import" href="./store/store.html">

<dom-module id="matrix-gamepad-socket">
  <script>
    class MatrixGamepadSocket extends ReduxMixin(Polymer.Element) {
      static get is() { return 'matrix-gamepad-socket'; }
      static get properties() {
        return {};
      }
      static get actions() {
        return {
          newFrame: (frame) => {
            return {
              type: 'NEW_FRAME',
              frame
            };
          }
        };
      }

      command(cmd) {
        this._socket.emit('command', cmd);
      }

      ready() {
        super.ready();
        this._socket = io(window.origin);
        this._socket.on('connect', () => { });
        this._socket.on('frame', (data) => {
          if (data.number == 0) {
            this.dispatch('newFrame', data.pixels);
          }
        });
        this._socket.on('disconnect', () => { });
      }
    }

    window.customElements.define(MatrixGamepadSocket.is, MatrixGamepadSocket);
  </script>
</dom-module>